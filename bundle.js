!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n(9),function(t){t&&t.__esModule}(n(1));var o=null,i=null,a=null,c=null,u=null,l=null,s=null,f=null,d=null,p=null,h=null,g=null,v=d3.timeParse("%y-%m-%d"),y=d3.timeFormat("%b %d"),m=d3.timeParse("%b %d"),b=d3.timeFormat("2018-%m-%d"),k="Nov 19",w="Nov 25",x="NYC",A="LAX",_="Thanksgiving",M=d3.select("#flights"),P=M.select(".graphic-wrapper"),E=P.select(".flights-chart"),C=(M.select(".date-selection-check").select("input"),M.select(".city-block-departure")),D=C.selectAll(".city-details"),L=C.select(".city-prompt"),S=null,j=null,O=null,H=null,N=[{code:"NYC",link:"/m/02_286"},{code:"LON",link:"/m/04jpl"},{code:"WAS",link:"/m/0rh6k"},{code:"ORL",link:"/m/0ply0"},{code:"LAX",link:"LAX"},{code:"SFO",link:"SFO"},{code:"CHI",link:"/m/01_d4"},{code:"HNL",link:"HNL"},{code:"LAS",link:"LAS"},{code:"MIA",link:"MIA"},{code:"SEA",link:"SEA"},{code:"DAL",link:"/m/0f2rq"},{code:"ATL",link:"ATL"},{code:"BOS",link:"BOS"}];function T(){var t=M.selectAll(".chart-cta-link"),e=d3.map(N,function(t){return t.code}),n=e.get(x).link,r=e.get(A).link,o=b(m(k)),i=b(m(w));t.attr("href","https://google.com/flights?source=Holiday2018#flt="+n+"."+r+"."+o+"*"+r+"."+n+"."+i).attr("target","_blank")}function B(t){"Thanksgiving"==t?(k="Nov 19",w="Nov 25"):"December Holidays"==t?(k="Dec 20",w="Dec 25"):"New Years"==t&&(k="Dec 26",w="Jan 01"),i=o.filter(function(e){return e.holiday==t}),"Destination City"==A?(c=i.filter(function(t){return t.originCode}),a=i.filter(function(t){return t.originCode==x&&t.destinationCode==A}),z("origin"),z("departure"),G(),F("origin")):(c=i.filter(function(t){return t.originCode}),a=i.filter(function(t){return t.originCode==x&&t.destinationCode==A}),z("origin"),z("departure"),G(),F("origin"),F("departure"),T())}function F(t){var e=P.select(".city-block-"+t),n=null;"origin"==t&&(n=x,function(){var t=P.select(".departure-dropdown"),e=g.filter(function(t){return t.key===x})[0].values;t.selectAll("option").remove(),t.selectAll("option").data(function(t){var n=e.map(function(t){return t.key});return n.unshift("Destination City"),n}).enter().append("option").attr("value",function(t){return t}).text(function(t){return"Destination City"==t?"Destination City":p.get(t).name}).each(function(t){"Destination City"===t&&d3.select(this).property("disabled",!0)})}()),"departure"==t&&(n=A,O(a),j(k,w)),e.select(".city-code").text(n),e.select(".city-name").text(p.get(n).name),e.select(".city-lines").attr("src","assets/images/"+p.get(n).name.replace(/\s/g,"")+".jpg")}function z(t){var e=P.select("."+t+"-dropdown"),n=null;n="departure"==t?"destination":"origin",e.selectAll("option").data(function(t){var e=d3.nest().key(function(t){return t[n]}).entries(o),r=null;(n="origin")?r="Origin":(n="destination")&&(r="Destination");var i=e.map(function(t){return t.key});return i.unshift(r+" City"),i}).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}).each(function(e){e===t+" City"&&d3.select(this).property("disabled",!0)}),e.on("change",function(e){"origin"==t&&(x=d.get(this.value).code,L.classed("is-active",!0),D.classed("is-active",!1),A="Destination City",d3.select(".flights-chart").classed("hidden",!0),F("origin")),"departure"==t&&(A=this.value,L.classed("is-active",!1),D.classed("is-active",!0),a=i.filter(function(t){return t.originCode==x&&t.destinationCode==A}),F(t),d3.select(".flights-chart").classed("hidden",!1),T())})}function G(){var t=P.select(".originDate-dropdown"),e=d3.nest().key(function(t){return t.destinationCode}).entries(c);h=d3.nest().key(function(t){return t.depDate}).key(function(t){return t.retDate}).entries(e[0].values),t.selectAll("option").remove(),t.selectAll("option").data(function(t){return h.map(function(t){return t.key}).filter(function(t){return"median"!=t})}).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}),t.on("change",function(t){d3.select(this),k=this.value,function(){var t=P.select(".returnDate-dropdown"),e=h.filter(function(t){return t.key===k})[0].values;t.selectAll("option").data(function(t){return e.map(function(t){return t.key})}).enter().append("option").attr("value",function(t){return t}).text(function(t){return t})}(),j(k,w),T()});var n=P.select(".returnDate-dropdown"),r=h.filter(function(t){return t.key===k})[0].values;n.selectAll("option").remove(),n.selectAll("option").data(function(t){return r.map(function(t){return t.key})}).enter().append("option").attr("value",function(t){return t}).text(function(t){return t}),n.on("change",function(t){w=this.value,j(k,w),T()})}function W(t){u=t[0],l=d3.map(u,function(t){return t.value}),d=d3.map(u,function(t){return t.name}),p=d3.map(u,function(t){return t.code}),s=t[1],f=d3.map(s,function(t){return t.value})}function I(){return new Promise(function(t,e){d3.loadData("assets/data/flights.csv",function(n,u){n&&e(n),o=u[0].map(function(t){return r({},t,{origin:l.get(t.origin).name,originCode:l.get(t.origin).code,originAirports:l.get(t.origin).airport,destination:l.get(t.destination).name,destinationCode:l.get(t.destination).code,destinationAirport:l.get(t.destination).airport,depDate:25==t.departureDate?"median":y(v(f.get(t.departureDate).date)),retDate:25==t.returnDate?"median":y(v(f.get(t.returnDate).date)),price:10*+t.price,daysBeforeDeparture:+t.daysBeforeDeparture,origHoliday:t.holiday,holiday:function(t){return"t"==t?"Thanksgiving":"x"==t?"December Holidays":"n"==t?"New Years":void 0}(t.holiday),dateRange:25==t.departureDate?"median":y(v(f.get(t.departureDate).date))+" - "+y(v(f.get(t.returnDate).date))})}),d3.select("#flights").classed("not-loaded",!1),d3.select(".not-loaded-text").remove(),i=o.filter(function(t){return t.holiday==_}),c=i.filter(function(t){return t.originCode}),a=i.filter(function(t){return t.originCode==x&&t.destinationCode==A}),S=E.datum(a).flightChart(),D.classed("is-active",!0),j=S.highlight,O=S.data,S.median,H=S.resize,j(k,w),g=d3.nest().key(function(t){return t.originCode}).key(function(t){return t.destinationCode}).entries(o),z("origin"),z("departure"),G(),F("origin"),F("departure"),B(_),T(),t()})})}function q(t){console.error(t)}e.default={init:function(){return new Promise(function(t,e){new Promise(function(t,e){d3.loadData("assets/data/flightsDictionary.csv","assets/data/dateDictionary.csv",function(n,r){n?e(n):t(r)})}).then(W).then(I).then(t).catch(q)})},resize:function(){H()},setupHolidayFlights:B}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(0)),o=i(n(2));function i(t){return t&&t.__esModule?t:{default:t}}var a=d3.select("#holiday-select"),c=d3.selectAll(".holiday-span"),u=null;e.default={init:function(){a.on("change",function(t){u=this.value,r.default.setupHolidayFlights(u),o.default.setupHolidayHotels(u),c.text(u)})},resize:function(){}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(10);var r=null,o="Thanksgiving",i=null,a=["assets/data/hotelsData.csv","assets/data/POI.csv","assets/data/hotelNamesData.csv"],c=null,u=(d3.select("#hotels"),d3.select(".city-table"));function l(){var t=r[0],e=r[1],n=r[2],i=t.filter(function(t){return("Christmas"==t.holiday?"December Holidays":"New Year's"==t.holiday?"New Years":"Thanksgiving")==o}),a=d3.nest().key(function(t){return t.city}).entries(i).map(function(t){return t.key}),u=e.filter(function(t){var e;return e="Washington"==t.dest_name?"Washington DC":t.dest_name,a.includes(e)}),l=d3.nest().key(function(t){return t.city}).entries(i).map(function(t){return t.key}),s=n.filter(function(t){var e;return e="Washington"==t.dest_name?"Washington DC":t.dest_name,("Christmas"==t.holiday?"December Holidays":"New Year's"==t.holiday?"New Years":t.holiday)==o&&l.includes(e)});c=[i,u,s]}d3.select("#holiday-select"),e.default={init:function(){return new Promise(function(t){new Promise(function(t,e){var n;(n=d3).loadData.apply(n,a.concat([function(n,o){n?e(n):t(o),r=o}]))}).then(function(e){!function(){d3.select("#hotels").classed("not-loaded",!1),l();var t=u.datum(c).hotelsMap();i=t.data}(),t()})})},resize:function(){},setupHolidayHotels:function(t){o=t,l(),i(c,o)}}},function(t,e,n){"use strict";var r=l(n(4)),o=l(n(6)),i=l(n(7)),a=l(n(0)),c=l(n(2)),u=l(n(1));function l(t){return t&&t.__esModule?t:{default:t}}var s=d3.select("body"),f=0;s.classed("is-mobile",o.default.any()),window.addEventListener("resize",(0,r.default)(function(){var t=s.node().offsetWidth;f!==t&&(f=t,i.default.resize(),a.default.resize(),c.default.resize())},150)),u.default.init(),i.default.init(),a.default.init().then(c.default.init)},function(t,e,n){(function(e){var n=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,l="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,f=l||s||Function("return this")(),d=Object.prototype.toString,p=Math.max,h=Math.min,g=function(){return f.Date.now()};function v(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function y(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&d.call(t)==r}(t))return n;if(v(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=v(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var l=a.test(t);return l||c.test(t)?u(t.slice(2),l?2:8):i.test(t)?n:+t}t.exports=function(t,e,n){var r,o,i,a,c,u,l=0,s=!1,f=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){var n=r,i=o;return r=o=void 0,l=e,a=t.apply(i,n)}function b(t){var n=t-u;return void 0===u||n>=e||n<0||f&&t-l>=i}function k(){var t=g();if(b(t))return w(t);c=setTimeout(k,function(t){var n=e-(t-u);return f?h(n,i-(t-l)):n}(t))}function w(t){return c=void 0,d&&r?m(t):(r=o=void 0,a)}function x(){var t=g(),n=b(t);if(r=arguments,o=this,u=t,n){if(void 0===c)return function(t){return l=t,c=setTimeout(k,e),s?m(t):a}(u);if(f)return c=setTimeout(k,e),m(u)}return void 0===c&&(c=setTimeout(k,e)),a}return e=y(e)||0,v(n)&&(s=!!n.leading,i=(f="maxWait"in n)?p(y(n.maxWait)||0,e):i,d="trailing"in n?!!n.trailing:d),x.cancel=function(){void 0!==c&&clearTimeout(c),l=0,r=u=o=c=void 0},x.flush=function(){return void 0===c?a:w(g())},x}}).call(this,n(5))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}};e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(n(8)),o=d3.select(".dropdown-sticky-outer"),i=d3.select(".type-button-flights"),a=d3.select(".type-button-hotels");e.default={init:function(){(0,r.default)({selector:"#dropdown-sticky",offset:1,enter:function(){o.classed("is-fixed",!0)},exit:function(){o.classed("is-fixed",!1)}}),(0,r.default)({selector:"#flights",offset:.9,enter:function(){i.classed("is-active",!0)},exit:function(){i.classed("is-active",!1)}}),(0,r.default)({selector:"#hotels",offset:.9,enter:function(){a.classed("is-active",!0),i.classed("is-active",!1)},exit:function(){a.classed("is-active",!1),i.classed("is-active",!0)}})},resize:function(){}}},function(t,e,n){"use strict";var r,o;void 0===(o="function"==typeof(r=function(){return function(t){function e(){p=!1;var t=function(){if(l&&"number"==typeof l){var t=Math.min(Math.max(0,l),1);return g-t*g}return g}();(h=h.filter(function(e){var n=e.getBoundingClientRect().top<t;if(n&&!e.__enter_view){if(a(e),f)return!1}else!n&&e.__enter_view&&c&&c(e);return e.__enter_view=n,!0})).length||window.removeEventListener("scroll",n,!0)}function n(){p||(p=!0,d(e))}function r(){(function(){var t=document.documentElement.clientHeight,e=window.innerHeight||0;g=Math.max(t,e)})(),e()}function o(t){for(var e=t.length,n=[],r=0;r<e;r+=1)n.push(t[r]);return n}var i=t.selector,a=t.enter,c=t.exit,u=t.offset,l=void 0===u?0:u,s=t.once,f=void 0!==s&&s,d=null,p=!1,h=[],g=0;i&&a||console.error("must set selector and enter options"),d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"string"==typeof t?o(e.querySelectorAll(t)):t instanceof NodeList?o(t):t instanceof Array?t:void 0}(i),window.addEventListener("resize",r,!0),window.addEventListener("scroll",n,!0),r(),e()}})?r.call(e,n,e,t):r)||(t.exports=o)},function(t,e,n){"use strict";d3.selection.prototype.flightChart=function(t){var e=this.nodes().map(function(t){var e=d3.select(t),n=e.datum(),r=null,o=0,i=0,a=null,c=null,u=null,l=d3.scaleLinear(),s=null,f=d3.scaleLinear(),d=null,p=null,h=null,g=null;function v(){var t=(r=d3.nest().key(function(t){return t.dateRange}).sortValues(function(t,e){return t.daysBeforeDeparture-e.daysBeforeDeparture}).entries(n)).map(function(t){var e=t.values.map(function(t){return t.daysBeforeDeparture});return d3.max(e,function(t){return t})});a=d3.min(t,function(t){return t});var e=d3.max(n,function(t){return t.price});l=d3.scaleLinear().domain([a,0]).range([0,o]).clamp(!0),f=d3.scaleLinear().domain([0,e]).range([i,0]),s=d3.axisBottom(l).tickPadding(8).ticks(10),d=d3.axisLeft(f).tickPadding(8).tickSize(-o).ticks(8).tickFormat(function(t){return"$"+t})}function y(t){var e=d3.selectAll(".cat-path.path-highlight").data()[0].values,n=d3.bisector(function(t){return t.daysBeforeDeparture}).left,r=l.invert(d3.mouse(this)[0]),o=n(e,r,1),i=e[o-1],c=e[o],u=r-i.daysBeforeDeparture>c.daysBeforeDeparture-r?c:i,s=l(u.daysBeforeDeparture),d=f(u.price);g.attr("transform","translate("+s+", "+d+")"),g.selectAll(".tooltip-price, .tooltip-price-bg").text("Minimum: $"+u.price).attr("text-anchor",function(t){return u.daysBeforeDeparture>=a-20?"start":u.daysBeforeDeparture<=20?"end":"middle"}),g.selectAll(".tooltip-days, .tooltip-days-bg").text(u.daysBeforeDeparture+" Days Before Departure").attr("text-anchor",function(t){return u.daysBeforeDeparture>=a-20?"start":u.daysBeforeDeparture<=20?"end":"middle"})}var m={init:function(){c=e.append("svg"),u=c.append("g.g-axis");var t=c.append("g");t.at("transform","translate(0, 10)"),u.append("g").attr("class","x axis").at("transform","translate(40,"+i+")"),u.append("g").attr("class","y axis").selectAll("g").classed("g-baseline",function(t){return 0==t}),t.append("g.g-vis"),m.resize(),m.render()},resize:function(){return o=e.node().offsetWidth-40-5,i=e.node().offsetHeight-10-50,h=i,v(),p=d3.line().x(function(t){return l(t.daysBeforeDeparture)}).y(function(t){return f(t.price)}),u.select(".x").at("transform","translate(40,"+h+")").call(s),u.select(".y").call(d).at("transform","translate(40, 10)"),c.at({width:o+40+5,height:i+10+50}),c.select(".g-vis").selectAll(".cat-path, .cat-path-median").size()>0&&m.updateSize(),m},render:function(){var t=c.select(".g-vis").attr("transform","translate(40, 0)");return t.selectAll(".cat-path, .cat-path-median").remove(),t.selectAll(".cat-path").data(r).enter().append("path").attr("class",function(t){return"median"==t.key?"cat-path-median":"cat-path"}).attr("data-range",function(t){return t.key}),(g=t.append("g").attr("class","tooltip").style("display","none")).append("circle").attr("r",4).attr("tooltip-circle"),g.append("text").attr("class","tooltip-price-bg").attr("dy","-12px"),g.append("text").attr("class","tooltip-days-bg").attr("dy","-29px"),g.append("text").attr("class","tooltip-price").attr("dy","-12px"),g.append("text").attr("class","tooltip-days").attr("dy","-29px"),t.selectAll(".overlay").remove(),t.append("rect").attr("width",o).attr("height",i).attr("class","overlay").on("mouseover",function(){return g.style("display",null)}).on("mouseout",function(){return g.style("display","none")}).on("mousemove touchstart",y),m.updateSize(),m},updateSize:function(){c.select(".g-vis").selectAll(".cat-path, .cat-path-median").attr("d",function(t){return p(t.values)})},data:function(t){return arguments.length?(n=t,e.datum(n),v(),u.select(".y").transition().duration(500).call(d),u.select(".x").transition().duration(500).call(s),m.render(),m):n},highlight:function(t,e){var n=c.select(".g-vis").selectAll(".cat-path");n.classed("path-highlight",!1),n.filter(function(n){return n.key==t+" - "+e}).classed("path-highlight",!0).raise(),g.raise()},median:function(){var t=c.select(".g-vis").selectAll(".cat-path-median");t.classed("is-active",!t.classed("is-active"))}};return m.init(),m});return e.length>1?e:e.pop()}},function(t,e,n){"use strict";!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t}(n(11)),d3.selection.prototype.hotelsMap=function(t){var e=this.nodes().map(function(t){var e=d3.select("#hotels"),n=d3.select(t),r=n.datum(),o=r[0],i=r[1],a=r[2],c="Thanksgiving",u="San Francisco";function l(t){u=t.city,d3.selectAll(".row").classed("highlighted",!1),d3.selectAll(".row-"+t.city.replace(/\s/g,"")).classed("highlighted",!0),d3.selectAll(".individHotel").classed("is-active",function(e){var n;return n="Washington DC"==t.city?"Washington":t.city,e.dest_name==n}),d3.selectAll(".individHotel.is-active").selectAll("img").attr("src",function(t){return t.photo_url}),d3.selectAll(".attraction, .attraction-link").classed("is-active",function(e){var n;return n="Washington DC"==t.city?"Washington":t.city,e.dest_name==n}),d3.selectAll(".attraction.is-active").selectAll("img").attr("src",function(t){return t.poi_img_url}),d3.selectAll("span.location").text(function(e){return t.city}),d()}var s=[{code:"San Francisco",link:"san%20francisco+ca",key:"/m/0d6lp"},{code:"Boston",link:"boston+ma",key:"/m/01cx_"},{code:"Washington DC",link:"washington+dc",key:"/m/0rh6k"},{code:"Denver",link:"denver+co",key:"/m/02cl1"},{code:"Key West",link:"key%20west+fl",key:"/m/0rp46"},{code:"Paris",link:"paris+france",key:"/m/05qtj"},{code:"London",link:"london+england",key:"/m/04jpl"},{code:"Saint-Gilles",link:"saint-gilles",key:"/m/02vg18"},{code:"Las Vegas",link:"las%20vegas+nv",key:"/m/0cv3w"},{code:"Cancún",link:"cancun",key:"/m/01q98m"},{code:"San Diego",link:"san%20diego+ca",key:"/m/071vr"},{code:"Nuremberg",link:"nuremberg",key:"/m/05bkf"},{code:"Arlington",link:"arlington+va",key:"/m/0mpbx"},{code:"Anaheim",link:"anaheim+ca",key:"/m/0k9p4"},{code:"Venice",link:"venice+italy",key:"/m/07_pf"},{code:"Chicago",link:"chicago+il",key:"/m/01_d4"},{code:"Cape Town",link:"cape+town+south+africa",key:"/m/01yj2"},{code:"Lisbon",link:"lisbon+portugal",key:"/m/04llb"},{code:"Brussels",link:"brussels+belgium",key:"/m/0177z"},{code:"Bangkok",link:"bangkok+thailand",key:"/m/0fn2g"},{code:"New York",link:"new+york+city",key:"/m/02_286"},{code:"Toronto",link:"toronto+canada",key:"/m/0h7h6"}],f=[{holiday:"Thanksgiving",checkin:"2018-11-21",checkout:"2018-11-25"},{holiday:"December Holidays",checkin:"2018-12-22",checkout:"2018-12-26"},{holiday:"New Years",checkin:"2018-12-29",checkout:"2019-01-02"}];function d(){var t=e.select(".hotels-cta"),n=d3.map(s,function(t){return t.code}),r=d3.map(f,function(t){return t.holiday}),o=n.get(u).link,i=n.get(u).key,a=r.get(c).checkin,l=r.get(c).checkout;t.attr("href","https://search.google.com/local/places/hotel/categorical?q="+o+"+hotels&hotel_dates="+a+","+l+"&hotel_mode=1&utm_source=marketing&utm_campaign=Holiday2018").attr("target","_blank"),e.select(".activities-cta").attr("href","https://www.google.com/destination/map/topsights?q=things+to+do+in+"+o+"&site=search&output=search&dest_mid="+i+"&sa+dest_src=hd18").attr("target","_blank")}var p={init:function(){d(),p.resize(),p.render()},resize:function(){return p},render:function(){var t=d3.map(f,function(t){return t.holiday}),e=t.get(c).checkin,n=t.get(c).checkout,r=d3.select(".city-table");r.selectAll(".row").remove();var u=r.selectAll(".row").data(o).enter().append("div").attr("class",function(t){return"row row-"+t.city.replace(/\s/g,"")}).on("mouseover",l);u.append("p").attr("class","rank").text(function(t){return t.rank}),u.append("p").attr("class","city-name").text(function(t){return t.city}),u.append("p").attr("class","hotel-price").text(function(t){return"$"+t.price}),u.append("p").attr("class","hotel-savings").text(function(t){return(100*t.holidaySavings).toFixed(1)+"%"});var s=d3.select(".hotel-list");s.selectAll(".individHotel, .hotel-link").remove();var d=s.selectAll(".hotel-link").data(a).enter().append("a").attr("target","_blank").attr("class","hotel-link").attr("href",function(t){return"https://search.google.com/local/places/hotel/categorical?q="+t.hotel_name.replace(/\s/g,"+").toLowerCase()+"&hotel_dates="+e+","+n+"&hotel_mode=1&utm_source=marketing&utm_campaign=Holiday2018"}).selectAll(".individHotel").data(function(t){return[t]}).enter().append("div").attr("class",function(t){return"individHotel individHotel-"+t.dest_name.replace(/\s/g,"")});d.append("div").attr("class","imgHotel-wrapper").append("img").attr("data-src",function(t){return t.photo_url}).attr("class","hotel-img");var h=d.append("div").attr("class","descHotel");h.append("div").attr("class",function(t){return"star-img-"+t.stars}),h.append("h5").text(function(t){return t.hotel_name}),h.append("p").text(function(t){return t.description.substring(0,97)+"..."});var g=d3.select(".things-to-do");g.selectAll(".attraction, .attraction-link").remove();var v=g.selectAll(".attraction-link").data(i).enter().append("a").attr("target","_blank").attr("class",function(t){return"attraction-link attraction-link-"+t.dest_name.replace(/\s/g,"")}).attr("href",function(t){return"https://google.com/search?q="+t.poi_name.replace(/\s/g,"+").toLowerCase()+"&utm_source=marketing&utm_campaign=Holiday2018"}).selectAll(".attraction").data(function(t){return[t]}).enter().append("div").attr("class",function(t){return"attraction attraction-"+t.dest_name.replace(/\s/g,"")}).attr("data-search",function(t){return t.poi_name.replace(/\s/g,"+").toLowerCase()});v.append("div").attr("class","img-wrapper").append("img").attr("data-src",function(t){return t.poi_img_url}).attr("class","attr-img");var y=v.append("div").attr("class","desc");return y.append("h5").text(function(t){return t.poi_name}),y.append("p").text(function(t){return t.poi_medium_description}),function(){var t="San Francisco";"December Holidays"==c&&(t="Paris"),"New Years"==c&&(t="San Diego");var e=t.replace(/\s/g,"");d3.selectAll(".individHotel-"+e+", .attraction-"+e+", .attraction-link-"+e).classed("is-active",!0),d3.selectAll(".individHotel.is-active").selectAll("img").attr("src",function(t){return t.photo_url}),d3.selectAll(".attraction.is-active").selectAll("img").attr("src",function(t){return t.poi_img_url}),d3.select(".row-"+e).classed("highlighted",!0),d3.selectAll("span.location").text(function(e){return t})}(),p},updateSize:function(){},data:function(t,e){return arguments.length?(r=t,n.datum(t),c=e,o=t[0],i=t[1],a=t[2],o.map(function(t){return{0:+t.longitude,1:+t.latitude}}),p.render(),p):r}};return p.init(),p});return e.length>1?e:e.pop()}},function(t,e,n){"use strict";n.r(e);var r=function(t){return t},o=function(t){if(null==t)return r;var e,n,o=t.scale[0],i=t.scale[1],a=t.translate[0],c=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,s=new Array(l);for(s[0]=(e+=t[0])*o+a,s[1]=(n+=t[1])*i+c;u<l;)s[u]=t[u],++u;return s}},i=function(t){var e,n=o(t.transform),r=1/0,i=r,a=-r,c=-r;function u(t){(t=n(t))[0]<r&&(r=t[0]),t[0]>a&&(a=t[0]),t[1]<i&&(i=t[1]),t[1]>c&&(c=t[1])}function l(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(l);break;case"Point":u(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(u)}}for(e in t.arcs.forEach(function(t){for(var e,o=-1,u=t.length;++o<u;)(e=n(t[o],o))[0]<r&&(r=e[0]),e[0]>a&&(a=e[0]),e[1]<i&&(i=e[1]),e[1]>c&&(c=e[1])}),t.objects)l(t.objects[e]);return[r,i,a,c]},a=function(t,e){for(var n,r=t.length,o=r-e;o<--r;)n=t[o],t[o++]=t[r],t[r]=n},c=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return u(t,e)})}:u(t,e)};function u(t,e){var n=e.id,r=e.bbox,o=null==e.properties?{}:e.properties,i=l(t,e);return null==n&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:n,properties:o,geometry:i}:{type:"Feature",id:n,bbox:r,properties:o,geometry:i}}function l(t,e){var n=o(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var o=r[t<0?~t:t],i=0,c=o.length;i<c;++i)e.push(n(o[i],i));t<0&&a(e,c)}function c(t){return n(t)}function u(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function l(t){for(var e=u(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(l)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=c(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(c);break;case"LineString":n=u(e.arcs);break;case"MultiLineString":n=e.arcs.map(u);break;case"Polygon":n=s(e.arcs);break;case"MultiPolygon":n=e.arcs.map(s);break;default:return null}return{type:r,coordinates:n}}(e)}var s=function(t,e){var n={},r={},o={},i=[],a=-1;function c(t,e){for(var r in t){var o=t[r];delete e[o.start],delete o.start,delete o.end,o.forEach(function(t){n[t<0?~t:t]=1}),i.push(o)}}return e.forEach(function(n,r){var o,i=t.arcs[n<0?~n:n];i.length<3&&!i[1][0]&&!i[1][1]&&(o=e[++a],e[a]=n,e[r]=o)}),e.forEach(function(e){var n,i,a=function(e){var n,r=t.arcs[e<0?~e:e],o=r[0];return t.transform?(n=[0,0],r.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=r[r.length-1],e<0?[n,o]:[o,n]}(e),c=a[0],u=a[1];if(n=o[c])if(delete o[n.end],n.push(e),n.end=u,i=r[u]){delete r[i.start];var l=i===n?n:n.concat(i);r[l.start=n.start]=o[l.end=i.end]=l}else r[n.start]=o[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=c,i=o[c]){delete o[i.end];var s=i===n?n:i.concat(n);r[s.start=i.start]=o[s.end=n.end]=s}else r[n.start]=o[n.end]=n;else r[(n=[e]).start=c]=o[n.end=u]=n}),c(o,r),c(r,o),e.forEach(function(t){n[t<0?~t:t]||i.push([t])}),i},f=function(t){return l(t,d.apply(this,arguments))};function d(t,e,n){var r,o,i;if(arguments.length>1)r=function(t,e,n){var r,o=[],i=[];function a(t){var e=t<0?~t:t;(i[e]||(i[e]=[])).push({i:t,g:r})}function c(t){t.forEach(a)}function u(t){t.forEach(c)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":c(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":e.arcs.forEach(u)}}(e),i.forEach(null==n?function(t){o.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&o.push(t[0].i)}),o}(0,e,n);else for(o=0,r=new Array(i=t.arcs.length);o<i;++o)r[o]=o;return{type:"MultiLineString",arcs:s(t,r)}}var p=function(t){return l(t,h.apply(this,arguments))};function h(t,e){var n={},r=[],o=[];function i(t){t.forEach(function(e){e.forEach(function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)})}),r.push(t)}function a(e){return function(t){for(var e,n=-1,r=t.length,o=t[r-1],i=0;++n<r;)e=o,o=t[n],i+=e[0]*o[1]-e[1]*o[0];return Math.abs(i)}(l(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":i(e.arcs);break;case"MultiPolygon":e.arcs.forEach(i)}}),r.forEach(function(t){if(!t._){var e=[],r=[t];for(t._=1,o.push(e);t=r.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].forEach(function(t){t._||(t._=1,r.push(t))})})})}}),r.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:o.map(function(e){var r,o=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].length<2&&o.push(t)})})}),(r=(o=s(t,o)).length)>1)for(var i,c,u=1,l=a(o[0]);u<r;++u)(i=a(o[u]))>l&&(c=o[0],o[0]=o[u],o[u]=c,l=i);return o})}}var g=function(t,e){for(var n=0,r=t.length;n<r;){var o=n+r>>>1;t[o]<e?n=o+1:r=o}return n},v=function(t){var e={},n=t.map(function(){return[]});function r(t,n){t.forEach(function(t){t<0&&(t=~t);var r=e[t];r?r.push(n):e[t]=[n]})}function o(t,e){t.forEach(function(t){r(t,e)})}var i={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};for(var a in t.forEach(function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,n)}):e.type in i&&i[e.type](e.arcs,n)}),e)for(var c=e[a],u=c.length,l=0;l<u;++l)for(var s=l+1;s<u;++s){var f,d=c[l],p=c[s];(f=n[d])[a=g(f,p)]!==p&&f.splice(a,0,p),(f=n[p])[a=g(f,d)]!==d&&f.splice(a,0,d)}return n},y=function(t){if(null==t)return r;var e,n,o=t.scale[0],i=t.scale[1],a=t.translate[0],c=t.translate[1];return function(t,r){r||(e=n=0);var u=2,l=t.length,s=new Array(l),f=Math.round((t[0]-a)/o),d=Math.round((t[1]-c)/i);for(s[0]=f-e,e=f,s[1]=d-n,n=d;u<l;)s[u]=t[u],++u;return s}},m=function(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)u=t.bbox;else{if(!((n=Math.floor(e))>=2))throw new Error("n must be ≥2");var n,r=(u=t.bbox||i(t))[0],o=u[1],a=u[2],c=u[3];e={scale:[a-r?(a-r)/(n-1):1,c-o?(c-o)/(n-1):1],translate:[r,o]}}var u,l,s=y(e),f=t.objects,d={};function p(t){return s(t)}function h(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(h)};break;case"Point":e={type:"Point",coordinates:p(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(p)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(l in f)d[l]=h(f[l]);return{type:"Topology",bbox:u,transform:e,objects:d,arcs:t.arcs.map(function(t){var e,n=0,r=1,o=t.length,i=new Array(o);for(i[0]=s(t[0],0);++n<o;)((e=s(t[n],n))[0]||e[1])&&(i[r++]=e);return 1===r&&(i[r++]=[0,0]),i.length=r,i})}},b=function(t,e,n,r,o,i){3===arguments.length&&(r=i=Array,o=null);for(var a=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),c=new i(t),u=t-1,l=0;l<t;++l)a[l]=o;return{set:function(r,i){for(var l=e(r)&u,s=a[l],f=0;s!=o;){if(n(s,r))return c[l]=i;if(++f>=t)throw new Error("full hashmap");s=a[l=l+1&u]}return a[l]=r,c[l]=i,i},maybeSet:function(r,i){for(var l=e(r)&u,s=a[l],f=0;s!=o;){if(n(s,r))return c[l];if(++f>=t)throw new Error("full hashmap");s=a[l=l+1&u]}return a[l]=r,c[l]=i,i},get:function(r,i){for(var l=e(r)&u,s=a[l],f=0;s!=o;){if(n(s,r))return c[l];if(++f>=t)break;s=a[l=l+1&u]}return i},keys:function(){for(var t=[],e=0,n=a.length;e<n;++e){var r=a[e];r!=o&&t.push(r)}return t}}},k=function(t,e){return t[0]===e[0]&&t[1]===e[1]},w=new ArrayBuffer(16),x=new Float64Array(w),A=new Uint32Array(w),_=function(t){x[0]=t[0],x[1]=t[1];var e=A[0]^A[1];return 2147483647&(e<<5^e>>7^A[2]^A[3])};function M(t,e,n,r){P(t,e,n),P(t,e,e+r),P(t,e+r,n)}function P(t,e,n){for(var r,o=e+(n---e>>1);e<o;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function E(t){return null==t?{type:null}:("FeatureCollection"===t.type?function(t){var e={type:"GeometryCollection",geometries:t.features.map(C)};return null!=t.bbox&&(e.bbox=t.bbox),e}:"Feature"===t.type?C:D)(t)}function C(t){var e,n=D(t.geometry);for(e in null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox),t.properties){n.properties=t.properties;break}return n}function D(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(D)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}var L=function(t,e){var n=function(t){var e=1/0,n=1/0,r=-1/0,o=-1/0;function i(t){null!=t&&a.hasOwnProperty(t.type)&&a[t.type](t)}var a={GeometryCollection:function(t){t.geometries.forEach(i)},Point:function(t){c(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(c)},LineString:function(t){u(t.arcs)},MultiLineString:function(t){t.arcs.forEach(u)},Polygon:function(t){t.arcs.forEach(u)},MultiPolygon:function(t){t.arcs.forEach(l)}};function c(t){var i=t[0],a=t[1];i<e&&(e=i),i>r&&(r=i),a<n&&(n=a),a>o&&(o=a)}function u(t){t.forEach(c)}function l(t){t.forEach(u)}for(var s in t)i(t[s]);return r>=e&&o>=n?[e,n,r,o]:void 0}(t=function(t){var e,n={};for(e in t)n[e]=E(t[e]);return n}(t)),r=e>0&&n&&function(t,e,n){var r=e[0],o=e[1],i=e[2],a=e[3],c=i-r?(n-1)/(i-r):1,u=a-o?(n-1)/(a-o):1;function l(t){return[Math.round((t[0]-r)*c),Math.round((t[1]-o)*u)]}function s(t,e){for(var n,i,a,l,s,f=-1,d=0,p=t.length,h=new Array(p);++f<p;)n=t[f],l=Math.round((n[0]-r)*c),s=Math.round((n[1]-o)*u),l===i&&s===a||(h[d++]=[i=l,a=s]);for(h.length=d;d<e;)d=h.push([h[0][0],h[0][1]]);return h}function f(t){return s(t,2)}function d(t){return s(t,4)}function p(t){return t.map(d)}function h(t){null!=t&&g.hasOwnProperty(t.type)&&g[t.type](t)}var g={GeometryCollection:function(t){t.geometries.forEach(h)},Point:function(t){t.coordinates=l(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(l)},LineString:function(t){t.arcs=f(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(f)},Polygon:function(t){t.arcs=p(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(p)}};for(var v in t)h(t[v]);return{scale:[1/c,1/u],translate:[r,o]}}(t,n,e),o=function(t){var e,n,r,o,i=t.coordinates,a=t.lines,c=t.rings,u=a.length+c.length;for(delete t.lines,delete t.rings,r=0,o=a.length;r<o;++r)for(e=a[r];e=e.next;)++u;for(r=0,o=c.length;r<o;++r)for(n=c[r];n=n.next;)++u;var l=b(2*u*1.4,_,k),s=t.arcs=[];for(r=0,o=a.length;r<o;++r){e=a[r];do{f(e)}while(e=e.next)}for(r=0,o=c.length;r<o;++r)if((n=c[r]).next)do{f(n)}while(n=n.next);else d(n);function f(t){var e,n,r,o,a,c,u,f;if(r=l.get(e=i[t[0]]))for(u=0,f=r.length;u<f;++u)if(p(o=r[u],t))return t[0]=o[0],void(t[1]=o[1]);if(a=l.get(n=i[t[1]]))for(u=0,f=a.length;u<f;++u)if(h(c=a[u],t))return t[1]=c[0],void(t[0]=c[1]);r?r.push(t):l.set(e,[t]),a?a.push(t):l.set(n,[t]),s.push(t)}function d(t){var e,n,r,o,a;if(n=l.get(i[t[0]]))for(o=0,a=n.length;o<a;++o){if(g(r=n[o],t))return t[0]=r[0],void(t[1]=r[1]);if(v(r,t))return t[0]=r[1],void(t[1]=r[0])}if(n=l.get(e=i[t[0]+y(t)]))for(o=0,a=n.length;o<a;++o){if(g(r=n[o],t))return t[0]=r[0],void(t[1]=r[1]);if(v(r,t))return t[0]=r[1],void(t[1]=r[0])}n?n.push(t):l.set(e,[t]),s.push(t)}function p(t,e){var n=t[0],r=e[0],o=t[1];if(n-o!=r-e[1])return!1;for(;n<=o;++n,++r)if(!k(i[n],i[r]))return!1;return!0}function h(t,e){var n=t[0],r=e[0],o=t[1],a=e[1];if(n-o!=r-a)return!1;for(;n<=o;++n,--a)if(!k(i[n],i[a]))return!1;return!0}function g(t,e){var n=t[0],r=e[0],o=t[1]-n;if(o!==e[1]-r)return!1;for(var a=y(t),c=y(e),u=0;u<o;++u)if(!k(i[n+(u+a)%o],i[r+(u+c)%o]))return!1;return!0}function v(t,e){var n=t[0],r=e[0],o=t[1],a=e[1],c=o-n;if(c!==a-r)return!1;for(var u=y(t),l=c-y(e),s=0;s<c;++s)if(!k(i[n+(s+u)%c],i[a-(s+l)%c]))return!1;return!0}function y(t){for(var e=t[0],n=t[1],r=e,o=r,a=i[r];++r<n;){var c=i[r];(c[0]<a[0]||c[0]===a[0]&&c[1]<a[1])&&(o=r,a=c)}return o-e}return t}(function(t){var e,n,r,o=function(t){var e,n,r,o,i=t.coordinates,a=t.lines,c=t.rings,u=function(){for(var t=b(1.4*i.length,A,M,Int32Array,-1,Int32Array),e=new Int32Array(i.length),n=0,r=i.length;n<r;++n)e[n]=t.maybeSet(n,n);return e}(),l=new Int32Array(i.length),s=new Int32Array(i.length),f=new Int32Array(i.length),d=new Int8Array(i.length),p=0;for(e=0,n=i.length;e<n;++e)l[e]=s[e]=f[e]=-1;for(e=0,n=a.length;e<n;++e){var h=a[e],g=h[0],v=h[1];for(r=u[g],o=u[++g],++p,d[r]=1;++g<=v;)x(e,r,r=o,o=u[g]);++p,d[o]=1}for(e=0,n=i.length;e<n;++e)l[e]=-1;for(e=0,n=c.length;e<n;++e){var y=c[e],m=y[0]+1,w=y[1];for(x(e,u[w-1],r=u[m-1],o=u[m]);++m<=w;)x(e,r,r=o,o=u[m])}function x(t,e,n,r){if(l[n]!==t){l[n]=t;var o=s[n];if(o>=0){var i=f[n];o===e&&i===r||o===r&&i===e||(++p,d[n]=1)}else s[n]=e,f[n]=r}}function A(t){return _(i[t])}function M(t,e){return k(i[t],i[e])}l=s=f=null;var P,E=function(t,e,n,r,o){3===arguments.length&&(r=Array,o=null);for(var i=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),a=t-1,c=0;c<t;++c)i[c]=o;return{add:function(r){for(var c=e(r)&a,u=i[c],l=0;u!=o;){if(n(u,r))return!0;if(++l>=t)throw new Error("full hashset");u=i[c=c+1&a]}return i[c]=r,!0},has:function(r){for(var c=e(r)&a,u=i[c],l=0;u!=o;){if(n(u,r))return!0;if(++l>=t)break;u=i[c=c+1&a]}return!1},values:function(){for(var t=[],e=0,n=i.length;e<n;++e){var r=i[e];r!=o&&t.push(r)}return t}}}(1.4*p,_,k);for(e=0,n=i.length;e<n;++e)d[P=u[e]]&&E.add(i[P]);return E}(t),i=t.coordinates,a=t.lines,c=t.rings;for(n=0,r=a.length;n<r;++n)for(var u=a[n],l=u[0],s=u[1];++l<s;)o.has(i[l])&&(e={0:l,1:u[1]},u[1]=l,u=u.next=e);for(n=0,r=c.length;n<r;++n)for(var f=c[n],d=f[0],p=d,h=f[1],g=o.has(i[d]);++p<h;)o.has(i[p])&&(g?(e={0:p,1:f[1]},f[1]=p,f=f.next=e):(M(i,d,h,h-p),i[h]=i[d],g=!0,p=d));return t}(function(t){var e=-1,n=[],r=[],o=[];function i(t){t&&a.hasOwnProperty(t.type)&&a[t.type](t)}var a={GeometryCollection:function(t){t.geometries.forEach(i)},LineString:function(t){t.arcs=c(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(c)},Polygon:function(t){t.arcs=t.arcs.map(u)},MultiPolygon:function(t){t.arcs=t.arcs.map(l)}};function c(t){for(var r=0,i=t.length;r<i;++r)o[++e]=t[r];var a={0:e-i+1,1:e};return n.push(a),a}function u(t){for(var n=0,i=t.length;n<i;++n)o[++e]=t[n];var a={0:e-i+1,1:e};return r.push(a),a}function l(t){return t.map(u)}for(var s in t)i(t[s]);return{type:"Topology",coordinates:o,lines:n,rings:r,objects:t}}(t))),i=o.coordinates,a=b(1.4*o.arcs.length,S,j);function c(t){t&&u.hasOwnProperty(t.type)&&u[t.type](t)}t=o.objects,o.bbox=n,o.arcs=o.arcs.map(function(t,e){return a.set(t,e),i.slice(t[0],t[1]+1)}),delete o.coordinates,i=null;var u={GeometryCollection:function(t){t.geometries.forEach(c)},LineString:function(t){t.arcs=l(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(l)},Polygon:function(t){t.arcs=t.arcs.map(l)},MultiPolygon:function(t){t.arcs=t.arcs.map(s)}};function l(t){var e=[];do{var n=a.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function s(t){return t.map(l)}for(var f in t)c(t[f]);return r&&(o.transform=r,o.arcs=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,o,i=t[e],a=0,c=1,u=i.length,l=i[0],s=l[0],f=l[1];++a<u;)r=(l=i[a])[0],o=l[1],r===s&&o===f||(i[c++]=[r-s,o-f],s=r,f=o);1===c&&(i[c++]=[0,0]),i.length=c}return t}(o.arcs)),o};function S(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function j(t,e){var n,r=t[0],o=t[1],i=e[0],a=e[1];return o<r&&(n=r,r=o,o=n),a<i&&(n=i,i=a,a=n),r===i&&o===a}var O=function(t,e){var n,r=t.objects,o={};function i(t){var e,n;switch(t.type){case"Polygon":e=(n=a(t.arcs))?{type:"Polygon",arcs:n}:{type:null};break;case"MultiPolygon":e=(n=t.arcs.map(a).filter(N)).length?{type:"MultiPolygon",arcs:n}:{type:null};break;case"GeometryCollection":e=(n=t.geometries.map(i).filter(T)).length?{type:"GeometryCollection",geometries:n}:{type:null};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}function a(t){return t.length&&function(t){return e(t,!1)}(t[0])?[t[0]].concat(t.slice(1).filter(c)):null}function c(t){return e(t,!0)}for(n in null==e&&(e=H),r)o[n]=i(r[n]);return function(t){var e,n,r=t.objects,o={},i=t.arcs,a=i.length,c=-1,u=new Array(a),l=0,s=-1;function f(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(f);break;case"LineString":p(t.arcs);break;case"MultiLineString":case"Polygon":t.arcs.forEach(p);break;case"MultiPolygon":t.arcs.forEach(h)}}function d(t){t<0&&(t=~t),u[t]||(u[t]=1,++l)}function p(t){t.forEach(d)}function h(t){t.forEach(p)}function g(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(g)};break;case"LineString":e={type:"LineString",arcs:y(t.arcs)};break;case"MultiLineString":e={type:"MultiLineString",arcs:t.arcs.map(y)};break;case"Polygon":e={type:"Polygon",arcs:t.arcs.map(y)};break;case"MultiPolygon":e={type:"MultiPolygon",arcs:t.arcs.map(m)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}function v(t){return t<0?~u[~t]:u[t]}function y(t){return t.map(v)}function m(t){return t.map(y)}for(n in r)f(r[n]);for(e=new Array(l);++c<a;)u[c]&&(u[c]=++s,e[s]=i[c]);for(n in r)o[n]=g(r[n]);return{type:"Topology",bbox:t.bbox,transform:t.transform,objects:o,arcs:e}}({type:"Topology",bbox:t.bbox,transform:t.transform,objects:o,arcs:t.arcs})};function H(){return!0}function N(t){return t}function T(t){return null!=t.type}var B=function(t){var e,n=new Array(t.arcs.length),r=0;function o(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(o);break;case"Polygon":i(t.arcs);break;case"MultiPolygon":t.arcs.forEach(i)}}function i(t){for(var e=0,o=t.length;e<o;++e,++r)for(var i=t[e],a=0,c=i.length;a<c;++a){var u=i[a];u<0&&(u=~u);var l=n[u];null==l?n[u]=r:l!==r&&(n[u]=-1)}}for(e in t.objects)o(t.objects[e]);return function(t){for(var e,r=0,o=t.length;r<o;++r)if(-1===n[(e=t[r])<0?~e:e])return!0;return!1}};function F(t){var e=t[0],n=t[1],r=t[2];return Math.abs((e[0]-r[0])*(n[1]-e[1])-(e[0]-n[0])*(r[1]-e[1]))/2}function z(t){for(var e,n=-1,r=t.length,o=t[r-1],i=0;++n<r;)e=o,o=t[n],i+=e[0]*o[1]-e[1]*o[0];return Math.abs(i)/2}var G=function(t,e,n){return e=null==e?Number.MIN_VALUE:+e,null==n&&(n=z),function(r,o){return n(c(t,{type:"Polygon",arcs:[r]}).geometry.coordinates[0],o)>=e}},W=function(t,e,n){var r=B(t),o=G(t,e,n);return function(t,e){return r(t,e)||o(t,e)}};function I(t,e){return t[1][2]-e[1][2]}function q(t){return[t[0],t[1],0]}var Y=function(t,e){var n=t.transform?o(t.transform):q,r=function(){var t={},e=[],n=0;function r(t,n){for(;n>0;){var r=(n+1>>1)-1,o=e[r];if(I(t,o)>=0)break;e[o._=n]=o,e[t._=n=r]=t}}function o(t,r){for(;;){var o=r+1<<1,i=o-1,a=r,c=e[a];if(i<n&&I(e[i],c)<0&&(c=e[a=i]),o<n&&I(e[o],c)<0&&(c=e[a=o]),a===r)break;e[c._=r]=c,e[t._=r=a]=t}}return t.push=function(t){return r(e[t._=n]=t,n++),n},t.pop=function(){if(!(n<=0)){var t,r=e[0];return--n>0&&(t=e[n],o(e[t._=0]=t,0)),r}},t.remove=function(t){var i,a=t._;if(e[a]===t)return a!==--n&&(I(i=e[n],t)<0?r:o)(e[i._=a]=i,a),a},t}();null==e&&(e=F);var i=t.arcs.map(function(t){var o,i,c,u=[],l=0;for(i=1,c=(t=t.map(n)).length-1;i<c;++i)(o=[t[i-1],t[i],t[i+1]])[1][2]=e(o),u.push(o),r.push(o);for(t[0][2]=t[c][2]=1/0,i=0,c=u.length;i<c;++i)(o=u[i]).previous=u[i-1],o.next=u[i+1];for(;o=r.pop();){var s=o.previous,f=o.next;o[1][2]<l?o[1][2]=l:l=o[1][2],s&&(s.next=f,s[2]=o[2],a(s)),f&&(f.previous=s,f[0]=o[0],a(f))}return t});function a(t){r.remove(t),t[1][2]=e(t),r.push(t)}return{type:"Topology",bbox:t.bbox,objects:t.objects,arcs:i}},R=function(t,e){var n=[];return t.arcs.forEach(function(t){t.forEach(function(t){isFinite(t[2])&&n.push(t[2])})}),n.length&&function(t,e){if(n=t.length){if((e=+e)<=0||n<2)return t[0];if(e>=1)return t[n-1];var n,r=(n-1)*e,o=Math.floor(r),i=t[o];return i+(t[o+1]-i)*(r-o)}}(n.sort($),e)};function $(t,e){return e-t}var V=function(t,e){e=null==e?Number.MIN_VALUE:+e;var n=t.arcs.map(function(t){for(var n,r=-1,o=0,i=t.length,a=new Array(i);++r<i;)(n=t[r])[2]>=e&&(a[o++]=[n[0],n[1]]);return a.length=o,a});return{type:"Topology",transform:t.transform,bbox:t.bbox,objects:t.objects,arcs:n}},U=Math.PI,X=2*U,J=U/4,K=U/180,Q=Math.abs,Z=Math.atan2,tt=Math.cos,et=Math.sin;function nt(t,e){for(var n,r,o,i=0,a=t.length,c=0,u=t[e?i++:a-1],l=u[0]*K,s=u[1]*K/2+J,f=tt(s),d=et(s);i<a;++i){n=l,l=(u=t[i])[0]*K,s=u[1]*K/2+J,r=f,f=tt(s),o=d,d=et(s);var p=l-n,h=p>=0?1:-1,g=h*p,v=o*d,y=r*f+v*tt(g),m=v*h*et(g);c+=Z(m,y)}return c}function rt(t,e){var n=nt(t,!0);return e&&(n*=-1),2*(n<0?X+n:n)}function ot(t){return 2*Q(nt(t,!1))}n.d(e,"bbox",function(){return i}),n.d(e,"feature",function(){return c}),n.d(e,"mesh",function(){return f}),n.d(e,"meshArcs",function(){return d}),n.d(e,"merge",function(){return p}),n.d(e,"mergeArcs",function(){return h}),n.d(e,"neighbors",function(){return v}),n.d(e,"quantize",function(){return m}),n.d(e,"transform",function(){return o}),n.d(e,"untransform",function(){return y}),n.d(e,"topology",function(){return L}),n.d(e,"filter",function(){return O}),n.d(e,"filterAttached",function(){return B}),n.d(e,"filterAttachedWeight",function(){return W}),n.d(e,"filterWeight",function(){return G}),n.d(e,"planarRingArea",function(){return z}),n.d(e,"planarTriangleArea",function(){return F}),n.d(e,"presimplify",function(){return Y}),n.d(e,"quantile",function(){return R}),n.d(e,"simplify",function(){return V}),n.d(e,"sphericalRingArea",function(){return rt}),n.d(e,"sphericalTriangleArea",function(){return ot})}]);